<header class="masthead responsive-header pt-0"
  style="background: linear-gradient(to right, #0f2027, #203a43, #2c5364);">
  <div class="p-3" style="margin-bottom: 8rem; background-color: transparent; text-align: right;">
    <div *ngIf="!isLoggedIn" class="d-flex justify-content-between">
      <div class="alert alert-warning py-1 px-2 mb-2 small" role="alert">
        <small><i class="bi bi-exclamation-triangle-fill me-1"></i>
          Connectez-vous pour une meilleure expérience.</small>
      </div>
      <a class="forgot text-white" [routerLink]="['/auth/login/']" style="text-decoration: underline;">
        Connexion
      </a>
    </div>
    <div class="position-relative d-inline-block">
      <button *ngIf="user_infos" class="btn btnprofil text-white p-0" type="button" (click)="toggleProfileMenu()">
        <i class="bi bi-person-circle fs-4"></i>
      </button>

      <div *ngIf="profileMenuVisible" class="profile-menu dropdown-menu show end-0 mt-2">
        <a class="dropdown-item d-flex align-items-center gap-2" [routerLink]="['/profil']">
          <i class="bi bi-person-fill"></i> Profil
        </a>
        <a class="dropdown-item d-flex align-items-center gap-2" [routerLink]="['/user/activites']">
          <i class="bi bi-star-fill"></i> Activités
        </a>
        <a class="dropdown-item d-flex align-items-center gap-2" (click)="logout()">
          <i class="bi bi-box-arrow-right"></i> Déconnexion
        </a>
      </div>
    </div>

  </div>
  <div class="container div_header position-relative">
    <div *ngIf="coordonne?.latitude && !is_run" class="overlay">
      <div
        class="custom-alert alert alert-light d-flex flex-column justify-content-center align-items-center text-center">
        <span class="mb-3" style="font-size: 16px;">
          Trouvez en 1 seconde ce qui est le plus proche de vous. Cherchez, trouvez… localement et instantanément.
        </span>
        <button class="btn run" (click)="runApp()">OK</button>
      </div>
    </div>
    <div *ngIf="!isLoadingLocation && !coordonne?.latitude" class="overlay">
      <div
        class="custom-alert alert alert-warning d-flex flex-column justify-content-center align-items-center text-center">
        <p>La géolocalisation est désactivée. Pour une meilleure expérience veuillez autoriser la position lors de la
          demande ou dans les
          paramètres de votre navigateur.</p>
        <div class="col-12 d-flex justify-content-between p-0">
          <a href="https://support.google.com/chrome/answer/142065" target="_blank"
            class="btn btn-warning p-2">Autoriser la
            position</a>
          <button class="btn btn-dark p-2" (click)="navigateToHome()">Autorisation effèctuer</button>
        </div>
        <div *ngIf="isLoadingLocation" class="overlay">
          <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Chargement localisation...</span>
          </div>
        </div>
      </div>
    </div>
    <div class="row justify-content-center">
      <div class="col-xl-6">
        <div class="text-center text-white">
          <div class="d-flex justify-content-center logo" style="cursor: pointer;" (click)="navigateToHome()">
            <h1 class="mb-2 me-2 text-center">Coocle Search</h1>
            <i class="fas fa-laugh-wink fa-2x rotate-left" style="color: #ffc107; transform: rotate(-30deg);"></i>
          </div>
          <form class="form-subscribe" id="contactForm" [formGroup]="search_form" (ngSubmit)="Searchbusiness()">
            <div class="row justify-content-center">
              <div class="col-md-7 mb-2 grdiv_search">
                <input id="searchBar" class="form-control rounded-pill shadow-sm submit_search"
                  formControlName="textSearch" id="textSearch" type="text"
                  placeholder="Restaurants italiens à proximité..." style="height: 45px;" />
                <div class="col-md-auto submit_search">
                  <button id="filterBtn" class="btn btn-warning rounded-pill px-3 shadow-sm rotate-on-hover"
                    type="submit" style="height: 45px;"
                    [disabled]="search_form.get('textSearch')?.invalid || search_form.get('textSearch')?.value.trim() === ''">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
                <div class="position-relative search_respo">
                  <input id="searchBar" class="form-control rounded-pill shadow-sm pe-5" formControlName="textSearch"
                    id="textSearch" type="text" placeholder="Restaurants italiens à proximité..."
                    style="height: 45px;" />
                  <button id="filterBtn" type="submit" class="btn position-absolute search-btn-inside"
                    [disabled]="search_form.get('textSearch')?.invalid || search_form.get('textSearch')?.value.trim() === ''">
                    <i class="fas fa-search"></i>
                  </button>
                </div>

              </div>

            </div>
            <div *ngIf="loading" class="loading-overlay">
              <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Chargement...</span>
              </div>
            </div>
          </form>
          <div class="position-relative" style="min-height: 60px;">
            <div class="position-absolute top-50 start-50 translate-middle text-white text-center"
              *ngIf="(textSearch || searchDone) && All_business.length === 0">
              <h4 class="m-0">Aucun résultat trouvé.</h4>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
<section class="m-2">
  <div class="row mt-4" *ngIf="All_business.length > 0">
    <div class="col-md-4 col-12" [ngClass]="{ 'tablet-fullwidth': All_business.length === 1 }"
      *ngFor="let business of All_business.slice(0, visibleCount)">
      <div class="card mb-3 position-relative">
        <button *ngIf="business.source === 'internal'" class="btn btn-fav" (click)="toggleFavorite(business)"
          [ngClass]="{ 'active': isFavorite(business) }" title="Ajouter aux favoris">
          <i class="fas" [ngClass]="isFavorite(business) ? 'fa-heart' : 'fa-heart-broken'"></i>
        </button>
        <div class="row g-0">
          <div class="col-md-12">
            <div class="card-body">
              <h5 class="card-title fw-bold text-black">{{ business.bu_name }}</h5>
              <p class="card-text text-muted">{{ business.bu_description }}</p>
              <p class="card-text m-0"><i class="bi bi-telephone-fill text-secondary"></i> {{ business.phone }}</p>
              <p class="card-text m-0" *ngIf="business.bu_type !== 'physique'">
                <i class="bi bi-globe2 text-secondary"></i>
                <a [href]="business.bu_website" target="_blank">{{ business.bu_website }}</a>
              </p>

              <p class="card-text m-0" *ngIf="business.bu_type === 'physique'">
                <i class="bi bi-geo-alt-fill text-secondary"></i> {{ business.bu_city }}
              </p>
              <div class="mt-3 text-end">
                <button *ngIf="business.source === 'internal'" type="button"
                  (click)="readSingleBusiness(business.bu_uid)"
                  class="btn btn-sm d-inline-flex align-items-center gap-2 rounded-pill shadow viewbusiness"
                  onmouseover="this.style.background='linear-gradient(135deg, #ffc107, #6d5203)'"
                  onmouseout="this.style.background='linear-gradient(135deg, #6d5203, #ffc107)'">
                  <i class="bi bi-eye-fill" style="font-size: 1rem;"></i>
                  Voir
                </button>
                <a *ngIf="business.source === 'osm'" class="btn btn-outline-primary rounded-pill"
                  [href]="business?.localisation" target="_blank">
                  <i class="bi bi-geo-alt-fill"></i> Localisation
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="text-center" *ngIf="All_business.length > visibleCount">
    <button class="btn btn-outline-primary showAll" (click)="showAll()">Voir plus</button>
  </div>
</section>
<section class="showcase bg-white">
  <h2 class="text-center mb-4 fw-bold">Actualités Publicitaires</h2>
  <div class="container-fluid p-0">
    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"
          aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
          aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"
          aria-label="Slide 3"></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img class="d-block w-100"
            src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=1500&q=80"
            alt="Slide 1">
        </div>
        <div class="carousel-item">
          <img class="d-block w-100"
            src="https://images.unsplash.com/photo-1542856391-010fb87dcfed?auto=format&fit=crop&w=1500&q=80"
            alt="Slide 2">
        </div>
        <div class="carousel-item">
          <img class="d-block w-100"
            src="https://images.unsplash.com/photo-1600891964599-f61ba0e24092?auto=format&fit=crop&w=1500&q=80"
            alt="Slide 3">
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
        data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
        data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
  </div>
</section>


<section class="features-icons bg-white text-center py-5">
  <div class="container">
    <h2 class="mb-3 fw-bold text-center">Pourquoi utiliser Coocle ?</h2>
    <div class="row text-center">

      <div class="col-lg-4">
        <div class="mb-4 p-4 shadow rounded bg-light">
          <i class="bi bi-geo-alt-fill display-4 text-warning"></i>
          <h4 class="mt-3">Proximité garantie</h4>
          <p>Trouvez tout ce que vous cherchez — produits, services ou lieux — directement autour de votre position. Vos
            résultats sont toujours les plus proches de vous.</p>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="mb-4 p-4 shadow rounded bg-light">
          <i class="bi bi-map-fill display-4 text-primary"></i>
          <h4 class="mt-3">Résultats 100% locaux et fiables</h4>
          <p>Nous recherchons uniquement en Côte d’Ivoire, ce qui vous assure des informations précises, vraies et
            vérifiées, avec des localisations exactes.</p>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="mb-4 p-4 shadow rounded bg-light">
          <i class="bi bi-clock-history display-4 text-success"></i>
          <h4 class="mt-3">Mises à jour régulières</h4>
          <p>Parce que le local évolue vite, nos résultats sont actualisés tous les 3 mois pour rester pertinents et
            vous offrir la meilleure expérience possible.</p>
        </div>
      </div>

    </div>
  </div>


</section>
<button *ngIf="deferredPrompt" (click)="addToHomeScreen()" class="btn btn-primary appli">
  Ajouter à l'écran d'accueil
</button>

<button *ngIf="backToTopBtnVisible" (click)="scrollToTop()" id="backToTopBtn"
  style="background: none; border: none; color: black; font-size: 1.2rem; cursor: pointer;">
  Go back up ↑
</button>